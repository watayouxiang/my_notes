## PMS：PackageManagerServer

- 手机启动时，PMS 扫描 /data/app 文件夹的 apk 文件，通过 PackageParser#parseBaseApk 方法 dom 解析 AndroidManifest.xml 然后得到 mPackage 缓存到缓存中心 ArrayMap<String, PackageParser.Package> 集合中。mPackage 类中存有四大组件的信息缓存（activities, recivers, providers, services）。Activity信息模型类中又存了 ActivityInfo, ActivityIntentInfo 等信息。
- 手机启动慢的原因：60%～80% 都是耗在 PMS 扫描上（也就是 scanDirLI 方法）
- 所以 PMS 的作用有
  - 包管理
  - 包解析
  - 结果缓存
  - 提供查询接口

## AMS：

- 所以 AMS 的作用有
  - 反射构造出 Activity 等对象
    - 通过包名，从 PMS 的 mPackages 中拿到 ActivityInfo，通过反射创建 Activity 对象
  - 解释造出的对象

- ActivityThread 用于管理 Activity 生命周期。ActivityThread 中有 ArrayMap<IBinder, ActivityClientRecord> mActivites 对象，ActivityClientRecord 对象中有 Activity 的引用。
- 回顾 Activity 的启动流程（Launcher 请求 AMS 的过程）
  - Launcher#startActivitySafety  --> Activity#startActivity#startActivityForResult --> Instrumentation#exeStartActivity --> IActivityManager#startActivity --> AMS#startActivity
  - 从 Instrumentation#exeStartActivity 从可以看出 startActivity 是跨进程通信