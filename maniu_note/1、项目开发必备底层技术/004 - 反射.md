---
typora-root-url: ./notes_res
---

# åå°„

> - å­¦ä¹ ç›®æ ‡ï¼š
>   - åå°„åœ¨å†…å­˜ä¸Šçš„åŸç†ï¼Œåå°„ä¸ºä»€ä¹ˆè€—æ€§èƒ½ã€è°ƒç”¨æ…¢
>
> - ä¸ºä»€ä¹ˆè¦å­¦ä¹ å†…å­˜ï¼Ÿ
>   - å› ä¸ºåå°„çš„åŸç†å°±æ˜¯ä»å†…å­˜ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å¹¶æ‰§è¡Œçš„ä¸€ä¸ªè¿‡ç¨‹
> - androidä¸­ä¸æ˜¯å­—èŠ‚ç ï¼Œæ˜¯dexï¼Œdexæ˜¯ä»¥armæŒ‡ä»¤è¿è¡Œçš„

## é¢è¯•é¢˜

### 1ã€å†…å­˜è§’åº¦è®²javaè®¾è®¡ä¸­ä¸ºä»€ä¹ˆè¦è®¾è®¡classä¸object

ä¸ºä»€ä¹ˆè¦æœ‰classå’Œobjectï¼Ÿ

1. å‡å¦‚æ²¡æœ‰classï¼ˆç±»ä¿¡æ¯ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ª â€œå¯¹è±¡â€ éƒ½æœ‰ä¸€ä»½ç›¸åŒçš„ â€œç±»ä¿¡æ¯â€ï¼Œé€ æˆå†…å­˜çˆ†æ£šã€‚
2. å‡å¦‚æ²¡æœ‰objectï¼ˆå¯¹è±¡ï¼‰ï¼Œè™½ç„¶èŠ‚çœäº† â€œå†…å­˜â€ ï¼Œä½†æ˜¯ä¼šä¸å®‰å…¨ã€‚å› ä¸ºæ¯ä¸€ä¸ªå¯¹è±¡éƒ½èƒ½è½»æ˜“åœ°æ”¹å˜å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¿¡æ¯ï¼ˆå…¬å…±ä¿¡æ¯å­˜åœ¨classé‡Œï¼Œå·®å¼‚ä¿¡æ¯å­˜åœ¨objecté‡Œï¼‰ï¼Œé€šè¿‡ä¿®æ”¹å…¬å…±ä¿¡æ¯ï¼Œä»è€Œæ”¹å˜äº†å…¶ä»–å¯¹è±¡çš„ä¿¡æ¯ã€‚

> è”æƒ³ â€œæ–¹æ³•åŒºâ€ å’Œ â€œå †åŒºâ€ï¼š
>
> - class æ˜¯ä»ä»£ç åŠ è½½è¿‡æ¥çš„
> - class å­˜æ”¾åœ¨ â€œæ–¹æ³•åŒºâ€ï¼Œobject å­˜æ”¾åœ¨ â€œå †åŒºâ€
> - ä» â€œæ–¹æ³•åŒºâ€ ä¸­å®ä¾‹åŒ–ä¸€ä¸ª â€œå¯¹è±¡â€ æ”¾åˆ° â€œå †åŒºâ€

## 2ã€javaå†…å­˜åˆ†ä¸ºå“ªäº›éƒ¨åˆ†ï¼Œä¸ºä»€ä¹ˆjavaæœ‰å †åŒºã€æ–¹æ³•åŒº

### 1ï¼‰java å†…å­˜åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†

- æ–¹æ³•åŒºï¼ˆä¸»å­˜ï¼‰
  - ç±»ä¿¡æ¯classã€é™æ€å˜é‡ã€å…¨å±€å˜é‡ã€å¸¸é‡æ± ã€å¤„ç†é€»è¾‘çš„æŒ‡ä»¤é›†
- å †ï¼ˆä¸»å­˜ï¼‰
  - å¯¹è±¡å®ä¾‹ã€è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸ
- è™šæ‹Ÿæœºæ ˆï¼ˆé«˜é€Ÿç¼“å­˜åŒºï¼‰
  - æ ˆä¿¡æ¯ã€æ–¹æ³•çš„å±€éƒ¨å˜é‡
  - æ¯æ¬¡å¼€ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œçº¿ç¨‹ç§æœ‰åŒ–ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ
  - æ•°æ®å­˜æ”¾åœ¨ â€œé«˜é€Ÿç¼“å­˜åŒºâ€

- æœ¬åœ°æ–¹æ³•æ ˆï¼ˆé«˜é€Ÿç¼“å­˜åŒºï¼‰
  - nativeæ–¹æ³•

- ç¨‹åºè®¡æ•°å™¨
  - ç›‘å¬cupæ‰§è¡Œåˆ°å“ªä¸€å¥ä»£ç 

>  - æ‰§è¡Œå¼•æ“ï¼šå°†æ–¹æ³•åŒºä¸­å¯¹åº”çš„æ–¹æ³•çš„armæŒ‡ä»¤åŠ è½½åˆ°æ ˆåŒºï¼Œè€Œæ ˆåŒºä½äºé«˜é€Ÿç¼“å­˜ä¸­ï¼Œcpuåœ¨ç›´æ¥ä»é«˜é€Ÿç¼“å­˜ä¸­è¯»å–armæŒ‡ä»¤ï¼Œä¸€æ¡ä¸€æ¡æ‰§è¡Œã€‚
>
>  - javaè™šæ‹Ÿæœºæ˜¯ç”¨Cå’ŒC++å†™çš„ï¼Œc: malloc (500M)

### 2ï¼‰ä¸ºä»€ä¹ˆè™šæ‹Ÿæœºè¦è®¾è®¡æ–¹æ³•åŒºã€å †åŒºï¼Ÿ

javaè¯­è¨€æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä¸ç”¨ç¨‹åºå‘˜ç®¡ç†å†…å­˜ï¼ŒOracleä¸ºäº†ç®¡ç†javaå¯¹è±¡è¿è¡Œæœºåˆ¶ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰è®¾è®¡äº†æ–¹æ³•åŒºå’Œå †åŒºï¼ˆè°æ¥ç®¡ç†ï¼Œå½“ç„¶è¿˜æ˜¯C++æ¥ç®¡ç†ï¼‰ã€‚æ–¹æ³•åŒºå’Œå †åŒºçš„è®¾ç«‹åªæ˜¯ä¸ºäº†å¥½ç®¡ç†ï¼ˆåœ¨linuxç³»ç»Ÿï¼Œè¿™äº›åŒºåŸŸæœ¬èº«ä¹Ÿä¸å­˜åœ¨ï¼‰ã€‚

> å‡å¦‚æ²¡æœ‰æ–¹æ³•åŒºï¼šæ¯æ¬¡åˆ›å»ºå¯¹è±¡éƒ½è¦ä»ç£ç›˜åŠ è½½å­—èŠ‚ç ï¼Œç„¶ånewå‡ºæ¥ï¼Œæ€§èƒ½ä½ä¸‹
>
> åŠ å…¥æ²¡æœ‰å †åŒºï¼šæ¯æ¬¡åˆ›å»ºéƒ½è¦åŠ è½½ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æºå¸¦å¯¹åº”çš„classï¼Œç›¸å½“æ¶ˆè€—å†…å­˜

## 3ã€è™šæ‹Ÿæœºç»™Appçš„å†…å­˜æˆ‘ä»¬è¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ

- androidè™šæ‹Ÿæœºåœ¨linuxä¸­çš„ç”³è¯·å†…å­˜ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€æ¬¡æ€§mallocäº†ä¸€å¤§å—å†…å­˜ã€‚è€Œå†…å­˜ä¸­å°±æœ‰æ–¹æ³•åŒºå’Œå †åŒº
- å¼€å¯ä¸€ä¸ªAppä»£è¡¨è™šæ‹Ÿæœºmallocä¸€æ¬¡å†…å­˜ï¼ˆæ¯”å¦‚50Mï¼‰ã€‚å¦‚æœè¿è¡Œ10ä¸ªAppï¼Œé‚£ä¹ˆå°±æ˜¯500Mã€‚è™šæ‹Ÿæœºå Linuxå†…å­˜æ€»å…±æœ‰500M
- è™šæ‹Ÿæœºè‡ªå·±ç®¡ç†å†…éƒ¨å¯¹è±¡çš„åˆ†é…ï¼Œç”±äºå†…å­˜å›æ”¶éœ€è¦çŸ¥é“å¯¹è±¡å å¤šå¤§ç©ºé—´ï¼Œæ‰€ä»¥åœ¨åˆ†é…å¯¹è±¡æ—¶ï¼Œé™¤äº†å¯¹è±¡æœ¬èº«æˆ‘ä»¬çœ‹å¾—è§çš„å­—æ®µå¤–ï¼Œè¿˜éœ€è¦å¯¹è±¡çš„æè¿°ä¿¡æ¯
- klass æ˜¯androidæ‰€æœ‰å¯¹è±¡çš„æºå¤´

## 4ã€åˆ†æarmæŒ‡ä»¤ï¼ˆdexæŒ‡ä»¤ï¼‰

> - ç¡¬ä»¶è¯»å†™é€Ÿåº¦æ¯”è¾ƒï¼šcpu > é«˜é€Ÿç¼“å­˜ > ä¸»å­˜
>   - é«˜é€Ÿç¼“å­˜é€Ÿåº¦è·Ÿcpuå·®ä¸å¤šï¼Œæ‰€ä»¥cpuå¯ä»¥ç›´æ¥è·Ÿé«˜é€Ÿç¼“å­˜æ‰“äº¤é“
>   - ä¸»å­˜é€Ÿåº¦è¿œè¿œæ…¢äºcpuï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡é«˜é€Ÿç¼“å­˜æ‰èƒ½è·Ÿcpuæ‰“äº¤é“
> - å¦‚ä½•è·å–dexæŒ‡ä»¤ï¼šjava --> class --> dex
>   - javaç»è¿‡javacç¼–è¯‘å¾—åˆ°.classæ–‡ä»¶
>   - .classæ–‡ä»¶ç»è¿‡dexç¼–è¯‘å¾—åˆ°dexæŒ‡ä»¤
> - dxå‘½ä»¤è·¯å¾„ï¼š/Users/TaoWang/Library/Android/sdk/build-tools/26.0.2/dx

### 1ï¼‰æ·»åŠ dxçš„ä¸´æ—¶ç¯å¢ƒå˜é‡

```java
// æ·»åŠ  /Users/TaoWang/Library/Android/sdk/build-tools/26.0.2/ åˆ°ä¸´æ—¶ç¯å¢ƒå˜é‡
$ export PATH=$PATH:/Users/TaoWang/Library/Android/sdk/build-tools/26.0.2/

// æ‰§è¡Œdxå‘½ä»¤ï¼Œå¦‚æœæ­£ç¡®è¾“å…¥ï¼Œè¯´æ˜ç¯å¢ƒé…ç½®æ­£ç¡®
$ dx
```

### 2ï¼‰javaæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶

```java
// 1ã€ç¼–è¾‘ Person.java æ–‡ä»¶
// æ³¨æ„ï¼šæ”¾åœ¨æ ¹ç›®å½•ï¼Œä¸è¦æœ‰åŒ…å
public class Person {
    public void run() {
        Person person = new Person();
        person.test();
    }

    public void test() {
    }
}


// 2ã€å°† Person.java ç¼–è¯‘æˆ Person.class
// Build -> Mack Project ç”Ÿæˆclassæ–‡ä»¶ï¼š/builld/intermediates/javac/debug/classes/Person.class
```

### 3ï¼‰å°†classæ–‡ä»¶è½¬æˆdexæŒ‡ä»¤

```java
// 1ã€è¿›å…¥åˆ° Person.class æ‰€åœ¨ç›®å½•
$ cd /Users/TaoWang/Desktop/Demo/app/build/intermediates/javac/debug/classes 

// 2ã€ç”ŸæˆPerson.runçš„dexæŒ‡ä»¤
// --dexï¼šç¼–è¯‘æˆdex
// --verboseï¼šç¼–è¯‘è¿‡ç¨‹ä¸­æ‰“å°ä¿¡æ¯
// --dump-to=wata.txtï¼šè¾“å‡ºåˆ°wata.txt
// --dump-method=Person.runï¼šç¼–è¯‘çš„æ˜¯Person.runæ–¹æ³•
// --verbose-dump Person.classï¼šè¾“å…¥çš„ç±»è·¯å¾„
$ dx --dex --verbose --dump-to=wata.txt --dump-method=Person.run --verbose-dump Person.class

// 3ã€wata.txtçš„å®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š
// wata.txt ä¸­å­˜æ”¾çš„æ˜¯Person.runçš„dexæŒ‡ä»¤
Person.run:()V:
regs: 0002; ins: 0001; outs: 0001
  0000: code-address
  0000: local-snapshot
  0000: code-address
  0000: code-address
  0000: local-snapshot
  0000: local-start v1 "this": Person
  0000: code-address
  0000: code-address
  0000: local-snapshot
          v1 "this": Person
  0000: code-address
  0000: new-instance v0, Person // type@0000
  0002: code-address
  0002: code-address
  0002: local-snapshot
          v1 "this": Person
  0002: code-address
  0002: code-address
  0002: local-snapshot
          v1 "this": Person
  0002: code-address
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
  0005: code-address
  0005: code-address
  0005: local-snapshot
          v1 "this": Person
  0005: local-start v0 "person": Person
  0005: code-address
  0005: invoke-virtual {v0}, Person.test:()V // method@0002
  0008: code-address
  0008: code-address
  0008: local-snapshot
          v0 "person": Person
          v1 "this": Person
  0008: return-void
  0009: code-address
  debug info
    line_start: 3
    parameters_size: 0000
    0000: prologue end
    0000: line 3
    0005: line 4
    0005: +local v0 person Person
    0008: line 5
    end sequence
  source file: "Person.java"

// 4ã€åˆ é™¤wata.txtä¸­çš„ä¸é‡è¦ä¿¡æ¯åå¦‚ä¸‹ï¼š
// 0000ã€0002ã€0005...0009 æ˜¯ç¨‹åºè®¡æ•°å™¨
// åˆ é™¤æ‰çš„éƒ¨åˆ†æ˜¯ dexæ—¥å¿—
Person.run:()V:
regs: 0002; ins: 0001; outs: 0001
  0000: new-instance v0, Person // type@0000
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
  0005: invoke-virtual {v0}, Person.test:()V // method@0002
  0008: return-void

```

### 4ï¼‰è§£è¯»dexæŒ‡ä»¤ï¼ˆå±€éƒ¨å˜é‡ï¼‰

```java
public class Person {
    public void run() {
        Person person = new Person();
        person.test();
    }

    public void test() {
    }
}
```

```java
Person.run:()V:
regs: 0002; ins: 0001; outs: 0001

  // è¿™å¥æŒ‡ä»¤çš„å«ä¹‰ï¼š
  // å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡Personï¼Œç”¨æ¸¸æ ‡v0æŒ‡å‘è¯¥å¯¹è±¡
  //
  // å¯ä»¥å¾—å‡ºçš„ç»“è®ºï¼š
  // ç»“è®º1ï¼šç”±äºv0æ˜¯å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥v0å­˜æ”¾åœ¨æ ˆåŒºï¼ˆé«˜é€Ÿç¼“å­˜ï¼‰ä¸­
  // ç»“è®º2ï¼šæ— è®ºjavaå˜é‡åå¤šä¹ˆçš„é•¿ï¼Œç¼–è¯‘æˆdexæŒ‡ä»¤åæ˜¯ä¸€æ ·ï¼ˆå¯ä»¥è¯•éªŒå¾—å‡ºï¼‰
  // 
  // æ‰§è¡Œæ­¥éª¤ï¼š
  // ç¬¬ä¸€æ­¥ï¼šæ ˆåŒºä¸­ç”³æ˜ä¸€ä¸ªå˜é‡v0ï¼ˆæ ˆåŒº - é«˜é€Ÿç¼“å­˜ï¼‰
  // ç¬¬äºŒæ­¥ï¼šä¼šå°†Person.classåŠ è½½è¿›æ–¹æ³•åŒºï¼ˆæ–¹æ³•åŒº - ä¸»å­˜ï¼‰
  // ç¬¬ä¸‰æ­¥ï¼šåœ¨å †åŒºå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡Personï¼ˆå †åŒº - ä¸»å­˜ï¼‰
  // ç¬¬å››æ­¥ï¼šå°†v0æŒ‡å‘Personå¯¹è±¡
  0000: new-instance v0, Person // type@0000
  
  // æ‰§è¡Œæ­¥éª¤ï¼š
  // ç¬¬ä¸€æ­¥ï¼šé€šè¿‡å–åœ°å€ç¬¦ {v0} æ‹¿åˆ°å †åŒºçš„Personå¯¹è±¡
  // ç¬¬äºŒæ­¥ï¼šè°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
  
  0005: invoke-virtual {v0}, Person.test:()V // method@0002
  0008: return-void
```

### 5ï¼‰è§£è¯»dexæŒ‡ä»¤ï¼ˆå…¨å±€å˜é‡ï¼‰

```java
public class Person {
    private Person person;

    public void run() {
        person = new Person();
        person.test();
    }

    public void test() {
    }
}
```

```java
Person.run:()V:
regs: 0002; ins: 0001; outs: 0001
  
  // æ‰§è¡Œæ­¥éª¤ï¼š
  // 1ï¼‰åœ¨å †åŒºå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡Person
  // 2ï¼‰æ ˆåŒºç”³æ˜ä¸€ä¸ªå˜é‡v0
  // 3ï¼‰v0æŒ‡å‘å¯¹è±¡Person
  0000: new-instance v0, Person // type@0000
  
  // æ‰§è¡Œæ­¥éª¤ï¼š
  // 1ï¼‰é€šè¿‡å–åœ°å€ç¬¦ {v0} æ‹¿åˆ°å †åŒºçš„å¯¹è±¡Person
	// 2ï¼‰è°ƒç”¨å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
      
  // æ³¨æ„ï¼šå› ä¸ºç”³æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡Personï¼Œæ‰€ä»¥åœ¨æ–¹æ³•åŒºä¸­æœ‰ä¸€ä¸ªå…¨å±€å˜é‡v1
  // 			- v0åœ¨æ ˆåŒºï¼ˆé«˜é€Ÿç¼“å­˜ï¼‰ï¼ŒæŒ‡å‘Personå¯¹è±¡
  // 			- Personå¯¹è±¡åœ¨å †åŒºï¼ˆä¸»å­˜ï¼‰
  // 			- v1åœ¨æ–¹æ³•åŒºï¼ˆä¸»å­˜ï¼‰ï¼Œåœ¨æ‰§è¡Œè¯¥è¡ŒæŒ‡ä»¤å‰æš‚æ— æŒ‡å‘
  //
  // æ‰§è¡Œæ­¥éª¤ï¼š
  // 1ï¼‰æŠŠv0çš„å€¼èµ‹å€¼ç»™v1ï¼ˆæ­¤æ—¶v1çš„å€¼å°±ç­‰äºv0ï¼Œç”±äºv0æŒ‡å‘Personå¯¹è±¡ï¼Œæ‰€ä»¥v1ä¹ŸæŒ‡å‘Personå¯¹è±¡ï¼‰
  0005: iput-object v0, v1, Person.person:LPerson; // field@0000

  0007: iget-object v0, v1, Person.person:LPerson; // field@0000
  0009: invoke-virtual {v0}, Person.test:()V // method@0002
  000c: return-void
```

### 6ï¼‰è§£è¯»dexæŒ‡ä»¤ï¼ˆå±€éƒ¨è¿”å›ï¼‰

```java
public class Person {
    public Person run() {
        Person person = new Person();
        return person;
    }
}
```

```java
Person.run:()LPerson;:
regs: 0002; ins: 0001; outs: 0001
  
  // 1ï¼‰åœ¨å †åŒºå®ä¾‹åŒ–ä¸€ä¸ªPersonå¯¹è±¡
  // 2ï¼‰åœ¨æ ˆåŒºç”³æ˜ä¸€ä¸ªv0å˜é‡
  // 3ï¼‰v0æŒ‡å‘Personå¯¹è±¡
  0000: new-instance v0, Person // type@0000
  
  // 1ï¼‰é€šè¿‡å–åœ°å€ç¬¦ {v0} æ‹¿åˆ°å †åŒºçš„å¯¹è±¡Person
  // 2ï¼‰è°ƒç”¨å¯¹è±¡çš„ <init> åˆå§‹åŒ–æ–¹æ³•
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
    
  // 1ï¼‰å› ä¸ºv0åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿”å›ç»™cpu  
  0005: return-object v0
```

### 7ï¼‰è§£è¯»dexæŒ‡ä»¤ï¼ˆå…¨å±€è¿”å›ï¼‰

<img src="/åˆ†ædexæŒ‡ä»¤.jpg" alt="åˆ†ædexæŒ‡ä»¤" style="zoom:60%;" />

```java
public class Person {
    private Person person;

    public Person run() {
        person = new Person();
        return person;
    }
}
```

```java
Person.run:()LPerson;:
regs: 0002; ins: 0001; outs: 0001
  
  // 1ï¼‰åœ¨å †åŒºå®ä¾‹åŒ–ä¸€ä¸ªPersonå¯¹è±¡
  // 2ï¼‰åœ¨æ ˆåŒºç”³æ˜ä¸€ä¸ªv0å˜é‡
  // 3ï¼‰v0æŒ‡å‘Personå¯¹è±¡
  0000: new-instance v0, Person // type@0000
    
  // 1ï¼‰é€šè¿‡å–åœ°å€ç¬¦ {v0} æ‹¿åˆ°å †åŒºçš„å¯¹è±¡Person
  // 2ï¼‰è°ƒç”¨å¯¹è±¡çš„ <init> åˆå§‹åŒ–æ–¹æ³•
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
    
  // æ³¨æ„ï¼šå› ä¸ºç”³æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡Personï¼Œæ‰€ä»¥åœ¨æ–¹æ³•åŒºä¸­æœ‰ä¸€ä¸ªå…¨å±€å˜é‡v1
  // 			- v0åœ¨æ ˆåŒºï¼ˆé«˜é€Ÿç¼“å­˜ï¼‰ï¼ŒæŒ‡å‘Personå¯¹è±¡
  // 			- Personå¯¹è±¡åœ¨å †åŒºï¼ˆä¸»å­˜ï¼‰
  // 			- v1åœ¨æ–¹æ³•åŒºï¼ˆä¸»å­˜ï¼‰ï¼Œåœ¨æ‰§è¡Œè¯¥è¡ŒæŒ‡ä»¤å‰æš‚æ— æŒ‡å‘
  //
  // 1ï¼‰æŠŠv0çš„å€¼èµ‹å€¼ç»™v1ï¼ˆæ­¤æ—¶v1çš„å€¼å°±ç­‰äºv0ï¼Œç”±äºv0æŒ‡å‘Personå¯¹è±¡ï¼Œæ‰€ä»¥v1ä¹ŸæŒ‡å‘Personå¯¹è±¡ï¼‰
  0005: iput-object v0, v1, Person.person:LPerson; // field@0000

	// 1ï¼‰æŠŠv1çš„å€¼èµ‹å€¼ç»™v0ï¼ˆç›¸å½“äºä»£ç  v0=v1 ï¼‰
	// 
	// é‡ç‚¹ï¼šé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿”å›v0ï¼Œè€Œè¦å¤šè¿™ä¸€æ­¥æ“ä½œå‘¢ï¼Ÿ
	// ç­”ï¼šå› ä¸ºæ¶‰åŠåˆ°å¤šçº¿ç¨‹ï¼Œç›´æ¥è¿”å›v0ä¸å®‰å…¨ã€‚
	//    è®¾æƒ³ï¼šå‡å¦‚ç›´æ¥è¿”å›v0æ—¶ï¼Œæ­¤æ—¶v1è¢«ä¿®æ”¹æŒ‡å‘äº†å¦ä¸€ä¸ªPersonå¯¹è±¡ï¼Œè€Œv0æŒ‡å‘ä¾æ—§æ˜¯è€çš„Personå¯¹è±¡ã€‚
	//    å› æ­¤cpuä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¼šå†è¯»ä¸€év1çš„å€¼ï¼ˆå› ä¸ºcpuä¸èƒ½ç›´æ¥æ‹¿åˆ°v1çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦æŠŠv1çš„å€¼èµ‹ç»™v0ï¼‰
  0007: iget-object v0, v1, Person.person:LPerson; // field@0000

  // 1ï¼‰å› ä¸ºv0åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿”å›ç»™cpu
  0009: return-object v0
```

## 5ã€ä»dexæŒ‡ä»¤è§’åº¦åˆ†æå•ä¾‹

```java
// å½“å‘ç”ŸæŒ‡ä»¤é‡æ’æ˜¯ï¼Œä¼šå‘ç”Ÿ RuntimeExceptionï¼Œæ¦‚ç‡å¤§æ¦‚æ˜¯ä¸€ä¸‡åˆ†ä¹‹ä¸€
// private static volatile Person instance;// åŠ volatileå¯ä»¥é¿å…æŒ‡ä»¤é‡æ’
public class Person {
    private static Person instance;

    public static Person getInstance() {
        if (instance == null) {
            synchronized (Person.class) {
                if (instance == null) {
                    instance = new Person();
                }
            }
        }
        return instance;
    }
}
```

```java
// Person.getInstanceçš„æŒ‡ä»¤é›†çœ‹ä¸æ‡‚ ğŸ˜­ğŸ˜­ğŸ˜­

Person.getInstance:()LPerson;:
regs: 0002; ins: 0000; outs: 0001
  0000: sget-object v0, Person.instance:LPerson; // field@0000
  0002: if-nez v0, 0013 // +0011
  0004: const-class v1, Person // type@0000
  0006: monitor-enter v1
  0007: sget-object v0, Person.instance:LPerson; // field@0000
  0009: if-nez v0, 0012 // +0009
  000b: new-instance v0, Person // type@0000
  000d: invoke-direct {v0}, Person.<init>:()V // method@0000
  0010: sput-object v0, Person.instance:LPerson; // field@0000
  0012: monitor-exit v1
    
  0013: sget-object v0, Person.instance:LPerson; // field@0000
  0015: return-object v0
```

## 6ã€é¢è¯•é¢˜ï¼šString str = new String("123")åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ

```
String str = new String("123"); åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ

åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚
"123"æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œå­—ç¬¦ä¸²å¸¸é‡ä¹Ÿæ˜¯å¸¸é‡ï¼Œå¸¸é‡å­˜æ”¾åœ¨æ–¹æ³•åŒºã€‚
str æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¯¹è±¡å­˜æ”¾åœ¨å †åŒºã€‚
å› æ­¤è¯¥è¡Œä»£ç åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚
```

## 7ã€ä¸ºä»€ä¹ˆâ€œå¯¹è±¡æ–¹æ³•è°ƒç”¨çš„é€Ÿåº¦â€è¿œå¿«äºâ€œåå°„æ–¹æ³•è°ƒç”¨çš„é€Ÿåº¦â€

>  javaä¸­çš„æ–¹æ³•ï¼Œæ˜¯æœ‰ä¸€ç³»åˆ—çš„æŒ‡ä»¤ç»„æˆï¼ˆjavaæ–¹æ³• = æŒ‡ä»¤é›†ï¼‰

### 1ï¼‰ç›´æ¥è°ƒç”¨æ–¹æ³•

```java
public class Person {
    public void run() {
        Person person = new Person();
        person.test();
        person.test2();
        person.test3();
        person.test4();
        person.test5();
    }

    public void test() {
    }
    public void test2() {
    }
    public void test3() {
    }
    public void test4() {
    }
    public void test5() {
    }
}
```

```java
Person.run:()V:
regs: 0002; ins: 0001; outs: 0001
  0000: new-instance v0, Person // type@0000
  0002: invoke-direct {v0}, Person.<init>:()V // method@0000
    
  // ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªæ–¹æ³•çš„æŒ‡ä»¤éƒ½æœ‰å¯¹åº”çš„å­˜æ”¾åœ°å€ï¼ˆmethod@0002ã€method@0003...ï¼‰
  // method@0002ã€method@0003...method@0006ï¼šè¿™ä¸ªå°±æ˜¯â€œæ–¹æ³•è¡¨â€ï¼Œâ€œæ–¹æ³•è¡¨â€å­˜æ”¾åœ¨â€œæ–¹æ³•åŒºâ€
  // Person.classä¸­æœ‰å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•ä¼šè¢«å°è£…æˆä¸€ä¸ªä¸ªArtMethodå¯¹è±¡ã€‚ä¸€ä¸ªä¸ªArtMethodå¯¹è±¡å°±ç»„æˆäº†æ–¹æ³•è¡¨ã€‚
  // 
  // å¯¹è±¡ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡è¯¥åœ°å€æ‰¾åˆ°æŒ‡ä»¤ï¼ˆæ— éœ€åŒ¹é…ã€å¯¹æ¯”ã€æ ¡éªŒæŒ‡ä»¤ï¼‰ï¼Œå› æ­¤è°ƒç”¨å°±å¿«
  0005: invoke-virtual {v0}, Person.test:()V // method@0002
  0008: invoke-virtual {v0}, Person.test2:()V // method@0003
  000b: invoke-virtual {v0}, Person.test3:()V // method@0004
  000e: invoke-virtual {v0}, Person.test4:()V // method@0005
  0011: invoke-virtual {v0}, Person.test5:()V // method@0006
    
  0014: return-void
```

### 2ï¼‰åå°„è°ƒç”¨æ–¹æ³•

```java
public static void main(String[] args) {
    Class<?> clazz = null;
    try {
        for (int i = 0; i < 1000; i++) {
            // è¿™é‡Œæœ‰æ‡’åŠ è½½æœºåˆ¶ï¼Œæ‰€ä»¥ä»…ä»…ç¬¬ä¸€æ¬¡æ…¢
            clazz = Class.forName("com.wata.demo.Person");
            // è¿™ä¸€æ­¥æ€§èƒ½æœ€å·®
          	// å› ä¸ºåå°„éœ€è¦ï¼š1ï¼‰æ ¹æ®æ–¹æ³•åæ‰¾åˆ°å¯¹åº”çš„æŒ‡ä»¤ 
          	//						 2ï¼‰åŒ¹é…æŒ‡ä»¤
          	//						 3ï¼‰å¯¹æ¯”æŒ‡ä»¤
          	//						 4ï¼‰æ ¡éªŒç­¾å
            Method method = clazz.getMethod("test");
            method.invoke(null);
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

# åå°„åŠåº”ç”¨åœºæ™¯2

> - new Threadæ˜¯æ¯”è¾ƒè´¹æ€§èƒ½çš„åŸå› ï¼š
>   - æ¯æ¬¡å¼€ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆåœ¨é«˜é€Ÿç¼“å­˜åŒºï¼Œå¤§å°ä¸º8kï¼‰ã€‚å½“çº¿ç¨‹æ‰§è¡Œç»“æŸåï¼Œåˆå›é”€æ¯å¯¹åº”çš„è™šæ‹Ÿæœºæ ˆã€‚å› æ­¤new Threadçš„æ–¹å¼æ˜¯æ¯”è¾ƒè´¹æ€§èƒ½çš„ã€‚
>   - è™šæ‹Ÿæœºä¸­çš„æ ˆæ˜¯æœ‰å¤šä¸ªçš„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„æ ˆã€‚
> - å‡å¦‚ä¸€ä¸ªcpuæœ‰å››æ ¸ï¼Œé‚£ä¹ˆåŒä¸€æ—¶é—´åªèƒ½è¿è¡Œå››ä¸ªçº¿ç¨‹

## 1ã€éªŒè¯androidè™šæ‹Ÿæœºçš„ç¼–è¯‘é¢„å¤„ç†

```java
// --------------------------------------------------
// 1ã€ç¼–å†™ Person.java
// --------------------------------------------------
// Person.java æ”¾åœ¨æ ¹ç›®å½•ï¼Œä¸è¦æœ‰åŒ…å
public class Person {
    public int test(){
        int a = 100;
        int b = 200;
        return a + b;
    }
}

// --------------------------------------------------
// 2ã€javac ç”Ÿæˆ Person.class 
// --------------------------------------------------
// Build -> Make Project, ç”ŸæˆPerson.classæ–‡ä»¶
// Person.classè·¯å¾„ï¼š/builld/intermediates/javac/debug/classes/Person.class
public class Person {
    public Person() {
    }

    public int test() {
        int a = 100;
        int b = 200;
        return a + b;
    }
}

// --------------------------------------------------
// 3ã€å°†.classçš„æŸä¸ªæ–¹æ³•ç¼–è¯‘æˆdexæŒ‡ä»¤
// --------------------------------------------------
// 1ï¼‰é…ç½®dxä¸´æ—¶ç¯å¢ƒå˜é‡
$ export PATH=$PATH:/Users/TaoWang/Library/Android/sdk/build-tools/26.0.2/

// 2ï¼‰è¿›å…¥åˆ° Person.class æ‰€åœ¨ç›®å½•
$ cd /Users/TaoWang/Desktop/Demo/app/build/intermediates/javac/debug/classes 

// 3ï¼‰æ‰§è¡Œdexç¼–è¯‘å‘½ä»¤ï¼Œç”ŸæˆPerson.testæ–¹æ³•çš„dexæŒ‡ä»¤
// --dexï¼šç¼–è¯‘æˆdex
// --verboseï¼šç¼–è¯‘è¿‡ç¨‹ä¸­æ‰“å°ä¿¡æ¯
// --dump-to=wata.txtï¼šè¾“å‡ºåˆ°wata.txt
// --dump-method=Person.runï¼šç¼–è¯‘çš„æ˜¯Person.runæ–¹æ³•
// --verbose-dump Person.classï¼šè¾“å…¥çš„ç±»è·¯å¾„
$ dx --dex --verbose --dump-to=wata.txt --dump-method=Person.test --verbose-dump Person.class

// 4ï¼‰åˆ å‡dexæ—¥å¿—ä¿¡æ¯åï¼Œå¾—åˆ°å¦‚ä¸‹dexæŒ‡ä»¤ï¼š
// è§‚å¯Ÿå‘ç°ï¼Œç›´æ¥è¿”å›äº†300ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œè®¡ç®—ï¼ˆä»è€ŒéªŒè¯androidè™šæ‹Ÿæœºæœ‰ç¼–è¯‘é¢„å¤„ç†ï¼ŒJVMæ²¡æœ‰ï¼‰
Person.test:()I:
regs: 0004; ins: 0001; outs: 0000
  0000: const/16 v0, #int 100 // #0064
  0002: const/16 v1, #int 200 // #00c8
  0004: const/16 v2, #int 300 // #012c
  0006: return v2
    
// --------------------------------------------------
// 4ã€è¯¥æƒ…å†µä¸‹ï¼Œæ— æ³•è¿›è¡Œç¼–è¯‘é¢„å¤„ç†
// --------------------------------------------------  
public class Person {
    public int test(int a, int b){
        return a + b;
    }
}

Person.test:(II)I:
regs: 0004; ins: 0003; outs: 0000
  0000: add-int v0, v2, v3
  0002: return v0
```

## 2ã€klassçŸ¥è¯†ç‚¹

> - å®‰å“è™šæ‹Ÿæœºæºç  class_link.cc
>
> - klass çš„ä¿¡æ¯éƒ½æ˜¯ä» class_link.cc ä¸­æ¥çš„

```java
// klassæ˜¯javaå¯¹è±¡çš„æè¿°ä¿¡æ¯ï¼ˆæ¯ä¸€ä¸ªjavaå¯¹è±¡ï¼Œéƒ½ä¼šæœ‰klassï¼‰
// klass çš„ objectSizeï¼Œæ˜¯ä¿®é¥°å¯¹è±¡åœ¨å †åŒºä¸­çš„å¤§å°ï¼Œä¸€ä¸ªç©ºå¯¹è±¡åœ¨å †åŒºä¸­å 8ä¸ªå­—èŠ‚ï¼ˆåœ¨ä¸åŒç‰ˆæœ¬çš„javaè™šæ‹Ÿæœºä¸­ï¼Œå ç”¨æœ‰æ‰€ä¸åŒï¼‰
// klass çš„ classSizeï¼Œæ˜¯ä¿®é¥°ç±»ä¿¡æ¯åœ¨æ–¹æ³•åŒºä¸­çš„å¤§å°ï¼Œä¸€ä¸ªç±»ä¿¡æ¯åœ¨æ–¹æ³•åŒºä¸­å 180ä¸ªå­—èŠ‚ï¼ˆåœ¨ä¸åŒç‰ˆæœ¬çš„javaè™šæ‹Ÿæœºä¸­ï¼Œå ç”¨æœ‰æ‰€ä¸åŒï¼‰

// --------------------------------------------------
// classSizeã€objectSize
// --------------------------------------------------

// klass çš„ classSize = 180
// klass çš„ objectSize = 8
public class Person {}

// --------------------------------------------------
// æˆå‘˜å˜é‡ï¼ˆå­˜æ”¾åœ¨å †åŒºï¼Œå±äºå¯¹è±¡ä¿¡æ¯ï¼‰
// --------------------------------------------------

// klass çš„ objectSize = 12ï¼ˆå¯¹è±¡æœ¬èº«8ä¸ªå­—èŠ‚+intç±»å‹æ‰€å çš„4ä¸ªå­—èŠ‚ï¼‰
public class Person {
    int x;
}

// klass çš„ objectSize = 16ï¼ˆå¯¹è±¡æœ¬èº«8ä¸ªå­—èŠ‚+doubleç±»å‹æ‰€å çš„8ä¸ªå­—èŠ‚ï¼‰
public class Person {
    double x;
}

// --------------------------------------------------
// é™æ€å˜é‡ï¼ˆå­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­ï¼Œå±äºç±»ä¿¡æ¯ï¼‰
// --------------------------------------------------

// klass çš„ classSize = 184ï¼ˆç±»æœ¬èº«180ä¸ªå­—èŠ‚+intæ‰€å çš„4ä¸ªå­—èŠ‚ï¼‰
public class Person {
    static int x;
}

// klass çš„ classSize = 192ï¼ˆç±»æœ¬èº«180ä¸ªå­—èŠ‚+doubleæ‰€å çš„8ä¸ªå­—èŠ‚+å†…å­˜å¯¹é½æ‰€å çš„4ä¸ªå­—èŠ‚ï¼‰
// æ³¨æ„ï¼šå†…å­˜å¯¹é½å¯ä»¥ç®€å•ç†è§£æˆï¼Œèƒ½è¢«8æ•´é™¤ã€‚ï¼ˆ188ä¸èƒ½è¢«8æ•´é™¤ï¼Œæ‰€ä»¥è¡¥é½4ä¸ªå­—èŠ‚ï¼‰
public class Person {
    static double x;
}

// klass çš„ classSize = 192ï¼ˆç±»æœ¬èº«180ä¸ªå­—èŠ‚+doubleæ‰€å çš„8ä¸ªå­—èŠ‚+intæ‰€å çš„4ä¸ªå­—èŠ‚ï¼‰
public class Person {
    static double x;
    static int 9;
}

// --------------------------------------------------
// æ–¹æ³•ï¼ˆå±äºç±»ä¿¡æ¯ï¼‰
// --------------------------------------------------

// classSize = 184ï¼ˆç±»æœ¬èº«180ä¸ªå­—èŠ‚ + æ–¹æ³•4ä¸ªå­—èŠ‚ï¼‰
// æ–¹æ³•åŠ è½½åˆ°æ–¹æ³•åŒºä¸­
// ä¸€ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ª ArtMethod å¼•ç”¨ï¼ˆæŒ‡å‘çš„æ˜¯æ–¹æ³•çš„åœ°å€ï¼‰
public class Person {
    public void run() {}
}
```

## 3ã€å†…å­˜è§’åº¦çœ‹å†…å­˜æ³„æ¼

```java
// --------------------------------------------------
// å†…å­˜æ³„æ¼
// --------------------------------------------------
public class MainActivity extends AppCompatActivity {
  
    class Person {}
    Person person;
  
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
   
        // æ­¤æ—¶ personå¯¹è±¡ çš„ objectSize = 12ï¼ˆæœ¬èº«çš„8ä¸ªå­—èŠ‚+4ä¸ªå­—èŠ‚æ˜¯MainActivityçš„å¼•ç”¨ï¼‰
        // å› æ­¤ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼
        person = new Person();
        person.hashCode();
    }
}


// --------------------------------------------------
// å†…å­˜æ³„æ¼
// --------------------------------------------------
public class MainActivity extends AppCompatActivity {
  
    class Person {}
    static Person person;
  
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
      
        // å†…å­˜æ³„æ¼ é€ æˆçš„åŸå› ï¼šé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡      
        // è¿™é‡Œå†…å­˜æ³„æ¼çš„åŸå› åˆ†æï¼š
        // 		personå˜é‡ è¢«staticä¿®é¥°ï¼Œå› æ­¤å­˜æ”¾åœ¨æ–¹æ³•åŒºï¼Œä¸ä¼šè¢«é”€æ¯ã€‚
        // 		personå˜é‡ æŒ‡å‘ å †åŒºçš„personå¯¹è±¡ï¼Œå †åŒºçš„personå¯¹è±¡ æŒæœ‰ MainActivityå¯¹è±¡ï¼Œ
        // 		å› æ­¤ MainActivityå¯¹è±¡ ä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼
        person = new Person();
        person.hashCode();
    }
}

// --------------------------------------------------
// ä¸ä¼šå†…å­˜æ³„æ¼
// --------------------------------------------------
public class MainActivity extends AppCompatActivity {
  
    static class Person {}
    static Person person;
  
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
      
        // æ­¤æ—¶ personå¯¹è±¡ çš„ objectSize = 8ï¼ˆæœ¬èº«çš„8ä¸ªå­—èŠ‚ï¼‰
        person = new Person();
        person.hashCode();
    }
}
```

## 4ã€æŸ¥çœ‹å®‰å“è™šæ‹Ÿæœºæºç 

å®‰å“è™šæ‹Ÿæœºæºç  class_link.cc
